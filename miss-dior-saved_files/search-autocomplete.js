jQuery(function(){jQuery("#search").autocomplete({serviceUrl:"/catalogsearch/result",paramName:"q",params:{json:1,fast:1},minChars:"2",deferRequestBy:"300",minLength:0,maxHeight:650,tabDisabled:true,appendTo:jQuery(".autocomplete-suggestions-container"),noCache:true,onSelect:function(suggestion){location.href=suggestion.data.url},beforeRender:function(container){if(!container.children().length)return;container.append('<div class="autocomplete-footer"><a href="/catalogsearch/result?q='+encodeURIComponent(this.value)+
'">\u0412\u0441\u0435 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b</a></div>')},formatResult:function(suggestion,currentValue){if(suggestion.data.kind==="product"){var template=jQuery.templates("#jsRenderSearchSuggestionProduct");var tplVars={url:suggestion.data.url,imgUrl:suggestion.data.imgUrl,brand:suggestion.data.brand,name:suggestion.data.name,title:suggestion.data.brand+" "+suggestion.data.name,type:suggestion.data.type}}else{var template=jQuery.templates("#jsRenderSearchSuggestionCategory");
var tplVars={url:suggestion.data.url,title:suggestion.data.title,kindName:suggestion.data.kindName}}return template.render(tplVars)},transformResult:function(response){response=JSON.parse(response);var brands=jQuery.map(response.brands,function(item){item.kind="brand";item.kindName="\u0411\u0440\u0435\u043d\u0434";return{value:item.title,data:item}});var categories=jQuery.map(response.categories,function(item){item.kind="category";item.kindName="\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f";
return{value:item.title,data:item}});var products=jQuery.map(response.products,function(item){item.kind="product";return{value:item.name,data:item}});return{suggestions:brands.concat(categories,products)}}})});
